{% extends 'base.html' %}
{% block title %}Dashboard Financeiro{% endblock %}
{% block content %}
<div class="d-flex justify-content-between align-items-center mb-4">
    <h1 class="h3 mb-0">Dashboard Financeiro</h1>
    <a href="{{ url_for('financeiro.config_banco_horas') }}" class="btn btn-outline-light btn-sm">
        <i class="fas fa-sliders me-1"></i>Configurações
    </a>
</div>

<div class="row g-4 mb-4">
    <div class="col-md-4">
        <div class="card p-3 stats-card">
            <div class="icon-box bg-orange-soft"><i class="fas fa-clock fa-lg"></i></div>
            <div class="text-muted small fw-bold text-uppercase">HE Mês Atual</div>
            <div class="h2 mb-0">{{ he_mes }}h</div>
            <div class="small mt-2 {{ 'text-danger' if he_mes > he_mes_anterior else 'text-success' }}">
                vs {{ he_mes_anterior }}h mês anterior
            </div>
        </div>
    </div>
    <div class="col-md-4">
        <div class="card p-3 stats-card">
            <div class="icon-box bg-purple-soft"><i class="fas fa-dollar-sign fa-lg"></i></div>
            <div class="text-muted small fw-bold text-uppercase">Custo HE Estimado</div>
            <div class="h2 mb-0">R$ {{ '%.2f'|format(custo_he) }}</div>
            <div class="small text-muted mt-2">R$ {{ valor_hora }}/hora configurado</div>
        </div>
    </div>
    <div class="col-md-4">
        <div class="card p-3 stats-card">
            <div class="icon-box bg-blue-soft"><i class="fas fa-chart-line fa-lg"></i></div>
            <div class="text-muted small fw-bold text-uppercase">Variação Mês</div>
            {% set variacao = he_mes - he_mes_anterior %}
            <div class="h2 mb-0 {{ 'text-danger' if variacao > 0 else 'text-success' }}">
                {{ '%+.1f'|format(variacao) }}h
            </div>
        </div>
    </div>
</div>

<div class="card p-4">
    <h5 class="mb-3">Top 5 – Horas Extras no Mês</h5>
    <div class="table-responsive">
        <table class="table">
            <thead><tr><th>#</th><th>Funcionário</th><th class="text-end">Horas Extras</th></tr></thead>
            <tbody>
                {% for row in top_he %}
                <tr>
                    <td class="text-muted">{{ loop.index }}</td>
                    <td>{{ row.nome }}</td>
                    <td class="text-end text-warning fw-bold">+{{ '%.1f'|format(row.total_he) }}h</td>
                </tr>
                {% else %}
                <tr><td colspan="3" class="text-center text-muted py-4">Sem dados de banco de horas ainda.</td></tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>
{% endblock %}
